// American continent airports database focused on Colombian aviation
export const americanAirports = {
  // ======================
  // COLOMBIA - COMPREHENSIVE
  // ======================
  
  // Major International Airports
  'BOG': { name: 'El Dorado International Airport', city: 'Bogotá', country: 'Colombia', type: 'international' },
  'MDE': { name: 'José María Córdova International Airport', city: 'Medellín', country: 'Colombia', type: 'international' },
  'CLO': { name: 'Alfonso Bonilla Aragón International Airport', city: 'Cali', country: 'Colombia', type: 'international' },
  'CTG': { name: 'Rafael Núñez International Airport', city: 'Cartagena', country: 'Colombia', type: 'international' },
  'BAQ': { name: 'Ernesto Cortissoz International Airport', city: 'Barranquilla', country: 'Colombia', type: 'international' },
  'SMR': { name: 'Simón Bolívar International Airport', city: 'Santa Marta', country: 'Colombia', type: 'international' },
  'BGA': { name: 'Palonegro International Airport', city: 'Bucaramanga', country: 'Colombia', type: 'international' },
  'PEI': { name: 'Matecaña International Airport', city: 'Pereira', country: 'Colombia', type: 'international' },
  'ADZ': { name: 'Gustavo Rojas Pinilla International Airport', city: 'San Andrés', country: 'Colombia', type: 'international' },
  'CUC': { name: 'Camilo Daza International Airport', city: 'Cúcuta', country: 'Colombia', type: 'international' },

  // Regional Airports
  'AXM': { name: 'El Edén International Airport', city: 'Armenia', country: 'Colombia', type: 'regional' },
  'IBE': { name: 'Perales Airport', city: 'Ibagué', country: 'Colombia', type: 'regional' },
  'NVA': { name: 'Benito Salas Airport', city: 'Neiva', country: 'Colombia', type: 'regional' },
  'VVC': { name: 'Vanguardia Airport', city: 'Villavicencio', country: 'Colombia', type: 'regional' },
  'LET': { name: 'Alfredo Vásquez Cobo International Airport', city: 'Leticia', country: 'Colombia', type: 'regional' },
  'FLA': { name: 'Gustavo Artunduaga Paredes Airport', city: 'Florencia', country: 'Colombia', type: 'regional' },
  'RCH': { name: 'Almirante Padilla Airport', city: 'Riohacha', country: 'Colombia', type: 'regional' },
  'VUP': { name: 'Alfonso López Pumarejo Airport', city: 'Valledupar', country: 'Colombia', type: 'regional' },
  'UIB': { name: 'El Caraño Airport', city: 'Quibdó', country: 'Colombia', type: 'regional' },
  'MTR': { name: 'Los Garzones Airport', city: 'Montería', country: 'Colombia', type: 'regional' },
  'EYP': { name: 'El Yopal Airport', city: 'Yopal', country: 'Colombia', type: 'regional' },
  'PSO': { name: 'Antonio Nariño Airport', city: 'Pasto', country: 'Colombia', type: 'regional' },
  'PPN': { name: 'Guillermo León Valencia Airport', city: 'Popayán', country: 'Colombia', type: 'regional' },
  'TCO': { name: 'La Florida Airport', city: 'Tumaco', country: 'Colombia', type: 'regional' },
  'APO': { name: 'Antonio Roldán Betancourt Airport', city: 'Apartadó', country: 'Colombia', type: 'regional' },
  'CZU': { name: 'Las Brujas Airport', city: 'Corozal', country: 'Colombia', type: 'regional' },
  'EOH': { name: 'Olaya Herrera Airport', city: 'Medellín', country: 'Colombia', type: 'regional' },
  'GPI': { name: 'Juan Casiano Airport', city: 'Guapi', country: 'Colombia', type: 'regional' },
  'IGO': { name: 'Hilario López Airport', city: 'Chigorodó', country: 'Colombia', type: 'regional' },
  'MVP': { name: 'Fabio Alberto León Bentley Airport', city: 'Mitú', country: 'Colombia', type: 'regional' },
  'PDA': { name: 'Obando Airport', city: 'Puerto Inírida', country: 'Colombia', type: 'regional' },
  'SJE': { name: 'Jorge E. Gonzalez Torres Airport', city: 'San José del Guaviare', country: 'Colombia', type: 'regional' },
  'TDA': { name: 'Trinidad Airport', city: 'Trinidad', country: 'Colombia', type: 'regional' },
  'AUC': { name: 'Santiago Pérez Airport', city: 'Arauca', country: 'Colombia', type: 'regional' },
  'BSC': { name: 'José Celestino Mutis Airport', city: 'Bahía Solano', country: 'Colombia', type: 'regional' },
  'CRC': { name: 'Santa Ana Airport', city: 'Cartago', country: 'Colombia', type: 'regional' },
  'TIB': { name: 'Tibú Airport', city: 'Tibú', country: 'Colombia', type: 'regional' },
  'TME': { name: 'Gustavo Vargas Airport', city: 'Tame', country: 'Colombia', type: 'regional' },

  // Private/Executive Airports in Colombia
  'BOGE': { name: 'Bogotá Executive Terminal', city: 'Bogotá', country: 'Colombia', type: 'private' },
  'MEDE': { name: 'Medellín Executive Airport', city: 'Medellín', country: 'Colombia', type: 'private' },
  'CALE': { name: 'Cali Executive Aviation', city: 'Cali', country: 'Colombia', type: 'private' },
  'CARE': { name: 'Cartagena Private Aviation', city: 'Cartagena', country: 'Colombia', type: 'private' },
  'LLANOS': { name: 'Llanos Private Airfield', city: 'Villavicencio', country: 'Colombia', type: 'private' },
  'CAUCA': { name: 'Cauca Valley Airstrip', city: 'Palmira', country: 'Colombia', type: 'private' },
  'GUAJIRA': { name: 'La Guajira Airfield', city: 'Riohacha', country: 'Colombia', type: 'private' },
  'SANTANDER': { name: 'Santander Executive', city: 'Bucaramanga', country: 'Colombia', type: 'private' },
  'ANDES': { name: 'Andes Mountain Strip', city: 'Manizales', country: 'Colombia', type: 'private' },
  'AMAZONAS': { name: 'Amazonas Regional Strip', city: 'Leticia', country: 'Colombia', type: 'private' },
  'PACIFICO': { name: 'Pacific Coast Airfield', city: 'Nuquí', country: 'Colombia', type: 'private' },
  'CAFETERO': { name: 'Coffee Triangle Executive', city: 'Armenia', country: 'Colombia', type: 'private' },

  // ======================
  // KEY INTERNATIONAL DESTINATIONS
  // ======================
  
  // United States - Major hubs for Colombian connections
  'MIA': { name: 'Miami International Airport', city: 'Miami', country: 'United States', type: 'international' },
  'JFK': { name: 'John F. Kennedy International Airport', city: 'New York', country: 'United States', type: 'international' },
  'LAX': { name: 'Los Angeles International Airport', city: 'Los Angeles', country: 'United States', type: 'international' },
  'ATL': { name: 'Hartsfield-Jackson Atlanta International Airport', city: 'Atlanta', country: 'United States', type: 'international' },
  'ORD': { name: "O'Hare International Airport", city: 'Chicago', country: 'United States', type: 'international' },
  'DFW': { name: 'Dallas/Fort Worth International Airport', city: 'Dallas', country: 'United States', type: 'international' },
  'TEB': { name: 'Teterboro Airport', city: 'Teterboro', country: 'United States', type: 'private' },

  // Central America
  'PTY': { name: 'Tocumen International Airport', city: 'Panama City', country: 'Panama', type: 'international' },
  'SJO': { name: 'Juan Santamaría International Airport', city: 'San José', country: 'Costa Rica', type: 'international' },

  // South America - Key neighbors
  'UIO': { name: 'Mariscal Sucre International Airport', city: 'Quito', country: 'Ecuador', type: 'international' },
  'LIM': { name: 'Jorge Chávez International Airport', city: 'Lima', country: 'Peru', type: 'international' },
  'CCS': { name: 'Simón Bolívar International Airport', city: 'Caracas', country: 'Venezuela', type: 'international' },
  'GRU': { name: 'São Paulo/Guarulhos International Airport', city: 'São Paulo', country: 'Brazil', type: 'international' },
  'EZE': { name: 'Ezeiza International Airport', city: 'Buenos Aires', country: 'Argentina', type: 'international' },
  'SCL': { name: 'Arturo Merino Benítez International Airport', city: 'Santiago', country: 'Chile', type: 'international' },

  // Mexico
  'MEX': { name: 'Mexico City International Airport', city: 'Mexico City', country: 'Mexico', type: 'international' },
  'CUN': { name: 'Cancún International Airport', city: 'Cancún', country: 'Mexico', type: 'international' },

  // Caribbean
  'SJU': { name: 'Luis Muñoz Marín International Airport', city: 'San Juan', country: 'Puerto Rico', type: 'international' },
  'SDQ': { name: 'Las Américas International Airport', city: 'Santo Domingo', country: 'Dominican Republic', type: 'international' },
  'CUR': { name: 'Curaçao International Airport', city: 'Willemstad', country: 'Curaçao', type: 'international' },
  'AUA': { name: 'Queen Beatrix International Airport', city: 'Oranjestad', country: 'Aruba', type: 'international' },

  // Europe (major destinations for Colombian business aviation)
  'MAD': { name: 'Adolfo Suárez Madrid-Barajas Airport', city: 'Madrid', country: 'Spain', type: 'international' },
  'LHR': { name: 'Heathrow Airport', city: 'London', country: 'United Kingdom', type: 'international' },
  'CDG': { name: 'Charles de Gaulle Airport', city: 'Paris', country: 'France', type: 'international' },
};

// Custom airports added by operators (stored in localStorage)
const CUSTOM_AIRPORTS_KEY = 'jetchance_custom_airports';

// Get custom airports from localStorage
export const getCustomAirports = () => {
  try {
    const stored = localStorage.getItem(CUSTOM_AIRPORTS_KEY);
    return stored ? JSON.parse(stored) : {};
  } catch (error) {
    console.error('Error loading custom airports:', error);
    return {};
  }
};

// Save custom airport to localStorage
export const saveCustomAirport = (code, airportInfo) => {
  try {
    const customAirports = getCustomAirports();
    customAirports[code.toUpperCase()] = {
      ...airportInfo,
      type: 'custom',
      addedAt: new Date().toISOString()
    };
    localStorage.setItem(CUSTOM_AIRPORTS_KEY, JSON.stringify(customAirports));
    return true;
  } catch (error) {
    console.error('Error saving custom airport:', error);
    return false;
  }
};

// Get all airports (built-in + custom)
export const getAllAirports = () => {
  const customAirports = getCustomAirports();
  return { ...americanAirports, ...customAirports };
};

// Function to get airport display info with fallback for unknown airports
export const getAirportInfo = (code, fallbackName = null, fallbackCity = null, fallbackCountry = null) => {
  const allAirports = getAllAirports();
  const airport = allAirports[code?.toUpperCase()];
  
  if (airport) {
    return {
      code: code.toUpperCase(),
      name: airport.name,
      city: airport.city,
      country: airport.country,
      type: airport.type,
      displayName: `${airport.city}, ${airport.country} (${code.toUpperCase()})`,
      shortDisplay: `${airport.city} (${code.toUpperCase()})`,
      fullDisplay: `${airport.name} - ${airport.city}, ${airport.country}`,
      flag: getCountryFlag(airport.country),
      isCustom: airport.type === 'custom'
    };
  }
  
  // If we have fallback info, create a temporary airport entry
  if (fallbackName && fallbackCity && fallbackCountry) {
    return {
      code: code?.toUpperCase() || 'N/A',
      name: fallbackName,
      city: fallbackCity,
      country: fallbackCountry,
      type: 'unknown',
      displayName: `${fallbackCity}, ${fallbackCountry} (${code?.toUpperCase() || 'N/A'})`,
      shortDisplay: `${fallbackCity} (${code?.toUpperCase() || 'N/A'})`,
      fullDisplay: `${fallbackName} - ${fallbackCity}, ${fallbackCountry}`,
      flag: getCountryFlag(fallbackCountry),
      isCustom: false,
      isUnknown: true
    };
  }
  
  // Complete fallback for unknown codes
  return {
    code: code?.toUpperCase() || 'N/A',
    name: code ? `${code.toUpperCase()} Airport` : 'Unknown Airport',
    city: code || 'Unknown',
    country: 'Unknown',
    type: 'unknown',
    displayName: `${code || 'Unknown'}`,
    shortDisplay: `${code || 'Unknown'}`,
    fullDisplay: `${code || 'Unknown'} Airport`,
    flag: '✈️',
    isCustom: false,
    isUnknown: true
  };
};

// Get country flag emoji
const getCountryFlag = (country) => {
  const flags = {
    'Colombia': '🇨🇴',
    'United States': '🇺🇸',
    'Panama': '🇵🇦',
    'Costa Rica': '🇨🇷',
    'Ecuador': '🇪🇨',
    'Peru': '🇵🇪',
    'Venezuela': '🇻🇪',
    'Brazil': '🇧🇷',
    'Argentina': '🇦🇷',
    'Chile': '🇨🇱',
    'Mexico': '🇲🇽',
    'Puerto Rico': '🇵🇷',
    'Dominican Republic': '🇩🇴',
    'Curaçao': '🇨🇼',
    'Aruba': '🇦🇼',
    'Spain': '🇪🇸',
    'United Kingdom': '🇬🇧',
    'France': '🇫🇷'
  };
  return flags[country] || '✈️';
};

// Function to search airports (built-in + custom)
export const searchAirports = (query) => {
  const searchTerm = query.toLowerCase();
  const allAirports = getAllAirports();
  
  return Object.entries(allAirports)
    .filter(([code, info]) => 
      code.toLowerCase().includes(searchTerm) ||
      info.city.toLowerCase().includes(searchTerm) ||
      info.country.toLowerCase().includes(searchTerm) ||
      info.name.toLowerCase().includes(searchTerm)
    )
    .map(([code, info]) => ({
      code,
      ...info,
      displayName: `${info.city}, ${info.country} (${code})`,
      shortDisplay: `${info.city} (${code})`,
      fullDisplay: `${info.name} - ${info.city}, ${info.country}`,
      flag: getCountryFlag(info.country),
      isCustom: info.type === 'custom'
    }));
};

// Suggest similar airports based on partial input
export const suggestAirports = (query, limit = 5) => {
  const searchResults = searchAirports(query);
  return searchResults.slice(0, limit);
};

// Get airports by country - useful for Colombian focus
export const getColombianAirports = () => {
  return Object.entries(americanAirports)
    .filter(([code, info]) => info.country === 'Colombia')
    .map(([code, info]) => ({ code, ...info, flag: '🇨🇴' }));
};

// Get popular Colombian routes
export const getPopularColombianRoutes = () => {
  return [
    { from: 'BOG', to: 'MDE', popularity: 95, type: 'domestic' },
    { from: 'BOG', to: 'CLO', popularity: 90, type: 'domestic' },
    { from: 'BOG', to: 'CTG', popularity: 85, type: 'domestic' },
    { from: 'MDE', to: 'CTG', popularity: 80, type: 'domestic' },
    { from: 'BOG', to: 'MIA', popularity: 95, type: 'international' },
    { from: 'MDE', to: 'MIA', popularity: 90, type: 'international' },
    { from: 'CTG', to: 'MIA', popularity: 85, type: 'international' },
    { from: 'BOG', to: 'PTY', popularity: 80, type: 'international' },
    { from: 'CLO', to: 'UIO', popularity: 75, type: 'international' },
    { from: 'BOG', to: 'LIM', popularity: 70, type: 'international' }
  ];
};

// Validate airport code format
export const isValidAirportCode = (code) => {
  if (!code) return false;
  const cleanCode = code.trim().toUpperCase();
  // Allow 3-4 character codes, letters and numbers
  return /^[A-Z0-9]{3,4}$/.test(cleanCode);
};